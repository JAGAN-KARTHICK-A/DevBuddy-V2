<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevBuddy-V2 New Project</title>
    <script src="/static/js/tailwind.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="/static/js/lucide.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: transparent; }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 antialiased select-none">

    <div class="flex flex-col h-screen p-1 rounded-lg">
        <!-- Title bar with close button -->
        <div class="flex justify-between items-center p-2 bg-gray-900">
            <span class="text-sm font-semibold">DevBuddy-V2 Create Project</span>
            <button id="close-btn" class="p-1 rounded-md hover:bg-red-500/80 transition-colors" title="Close">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>

        <div class="flex flex-col flex-grow p-5">
            <!-- Header with Back Button -->
            <header class="relative pb-4 border-b border-gray-700 flex items-center">
                <button id="back-btn" class="absolute left-0 p-1 rounded-full hover:bg-gray-700 transition-colors duration-200" title="Go Back">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                </button>
                <div class="flex-grow text-center">
                    <h1 class="text-xl font-bold text-white">Create New Project</h1>
                    <p class="text-sm text-gray-400">Set up your project details below.</p>
                </div>
            </header>

            <!-- Form Fields -->
            <main class="flex-grow py-6 space-y-6">
                <div>
                    <label for="project-name" class="block text-sm font-medium text-gray-300 mb-2">Project Name</label>
                    <div class="flex items-center gap-2">
                        <input type="text" id="project-name" placeholder="Enter a project name..." class="flex-grow w-full bg-gray-800 border border-gray-600 text-gray-300 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 p-2.5 placeholder-gray-500 cursor-default">
                    </div>
                </div>

                <div>
                    <label for="llm" class="block text-sm font-medium text-gray-300 mb-2">Model</label>
                    <select id="llm" class="bg-gray-800 border border-gray-600 text-gray-300 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block w-full p-2.5">
                        <option value="gemini-2.5-flash">gemini-2.5-flash</option>
                        <option value="gemini-pro">gemini-pro</option>
                        <option value="gpt" disabled>GPT-4 (Coming soon!)</option>
                        <option value="deepseek" disabled>DeepSeek (Coming soon!)</option>
                        <option value="qwen" disabled>Qwen (Coming soon!)</option>
                    </select>
                </div>

                <div>
                    <label for="api-key" class="block text-sm font-medium text-gray-300 mb-2">API Key</label>
                    <div class="flex items-center gap-2">
                        <input type="text" id="api-key" placeholder="Enter API key for the model selected..." class="flex-grow w-full bg-gray-800 border border-gray-600 text-gray-300 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 p-2.5 placeholder-gray-500 cursor-default">
                    </div>
                </div>

                <div>
                    <label for="project-folder" class="block text-sm font-medium text-gray-300 mb-2">Project Folder</label>
                    <div class="flex items-center gap-2">
                        <input type="text" id="project-folder" readonly placeholder="Select a folder..." class="flex-grow w-full bg-gray-800 border border-gray-600 text-gray-300 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 p-2.5 placeholder-gray-500 cursor-default">
                        <button id="browse-btn" class="px-4 py-2.5 bg-gray-700 text-sm font-medium rounded-lg hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-gray-500 transition-colors">Browse...</button>
                    </div>
                </div>
                
                <div>
                    <label for="language" class="block text-sm font-medium text-gray-300 mb-2">Language</label>
                    <select id="language" class="bg-gray-800 border border-gray-600 text-gray-300 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block w-full p-2.5">
                        <option value="python">Python</option>
                        <option value="javascript">JavaScript</option>
                        <option value="typescript">TypeScript</option>
                        <option value="html">HTML</option>
                        <option value="css">CSS</option>
                    </select>
                </div>
            </main>

            <!-- Footer Actions -->
            <footer class="pt-4 border-t border-gray-700">
                <button id="create-project-btn" class="w-full bg-indigo-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-indigo-500 disabled:bg-indigo-800 disabled:text-gray-400 disabled:cursor-not-allowed transition-colors duration-200" disabled>
                    Create Project
                </button>
            </footer>
        </div>
    </div>

    <script>
        const folderInput = document.getElementById('project-folder');
        const langSelect = document.getElementById('language');
        const projectName = document.getElementById("project-name");
        const llm_model = document.getElementById("llm");
        const api_key = document.getElementById("api-key");
        const createBtn = document.getElementById('create-project-btn');

        function checkFormValidity() {
            const folderSelected = folderInput.value.trim() !== '';
            const langSelected = langSelect.value !== '';
            const projectNameSelected = projectName.value !== '';
            createBtn.disabled = !((folderSelected && langSelected)&&projectNameSelected);
        }

        document.getElementById('back-btn').addEventListener('click', () => {
            window.location.href = 'index.html';
        });
        
        document.getElementById('close-btn').addEventListener('click', () => {
            window.pywebview.api.close_app();
        });

        document.getElementById('browse-btn').addEventListener('click', async () => {
            const folderPath = await window.pywebview.api.open_folder_dialog();
            if (folderPath) {
                folderInput.value = folderPath;
                checkFormValidity();
            }
        });

        langSelect.addEventListener('change', checkFormValidity);
        projectName.addEventListener('change', checkFormValidity);
        llm_model.addEventListener('change', checkFormValidity);
        api_key.addEventListener('change', checkFormValidity);

        createBtn.addEventListener('click', async () => {
            if (createBtn.disabled) return;
            
            const folderPath = folderInput.value;
            const language = langSelect.value;
            const name = projectName.value;
            const model = llm_model.value;
            const apiKey = api_key.value;
            
            // Show loading state
            createBtn.disabled = true;
            createBtn.textContent = 'Creating...';
            
            // Call Python to handle project creation and open the new window
            const response = await window.pywebview.api.create_project(folderPath, language, name, model, apiKey);
            console.log(response);
            // The Python function will handle closing this window.
        });
    </script>
</body>
</html>

